## إصلاح شامل لمشكلة ProgrammingError في استمارة المواطنين

### المشاكل المحددة:
1. **خطأ 500 (ProgrammingError)**: مشكلة في قاعدة البيانات - الحقول المطلوبة غير موجودة
2. **خطأ 400 للإرسال المجهول**: الحقول المطلوبة في الإرسال المجهول

### الحلول المطبقة:

#### 1. إصلاح نموذج Django:
- تم جعل الحقول الشخصية (`citizen_phone`, `citizen_email`, `citizen_address`, `citizen_id`) اختيارية
- تم إضافة قيم افتراضية للحقول
- تم إضافة جميع الحقول المطلوبة مع التحقق الصحيح

#### 2. إصلاح الـ Serializer:
- تم إضافة validation مخصص للإرسال المجهول
- تم إزالة الحقول غير المطلوبة من المعالجة

#### 3. إصلاح الـ Frontend:
- تم تحديث معالجة الإرسال المجهول
- تم إضافة field mapping صحيح
- تم تحديث الـ validation

#### 4. إصلاح إعدادات قاعدة البيانات:
- تم تغيير DB_HOST من 'db' إلى 'localhost'

#### 5. إضافة endpoint مخصص:
- تم إنشاء `/api/forms/citizen-feedback/create/` مع معالجة خاصة للإرسال المجهول

### خطوات الإصلاح:

#### 1. تطبيق التغييرات:
```bash
cd backend
python manage.py makemigrations forms
python manage.py migrate
python manage.py runserver
```

#### 2. اختبار الإرسال العادي:
- املأ جميع الحقول المطلوبة
- لا تفعل "إرسال مجهول"
- اضغط إرسال

#### 3. اختبار الإرسال المجهول:
- املأ الحقول الأساسية فقط (نوع الملاحظة، الموضوع، الوصف، المحافظة، المدينة)
- فعل "إرسال مجهول"
- اضغط إرسال

### التوقعات:
✅ **الإرسال العادي**: يجب أن يعمل بشكل صحيح مع جميع الحقول
✅ **الإرسال المجهول**: يجب أن يعمل مع الحقول الأساسية فقط
✅ **لا يوجد خطأ 500**: تم حل مشكلة قاعدة البيانات
✅ **لا يوجد خطأ 400**: تم حل مشكلة الحقول المطلوبة

### في حالة استمرار المشكلة:
إذا استمر خطأ 500:
1. تأكد من أن PostgreSQL يعمل
2. تأكد من أن الـ migrations تم تطبيقها
3. تحقق من logs الخادم للتفاصيل

إذا استمر خطأ 400:
1. تأكد من أن جميع الحقول المطلوبة موجودة
2. تحقق من الـ validation في الـ serializer
3. تأكد من أن الـ field mapping صحيح

### الملفات المعدلة:
- `forms/models.py`: إضافة الحقول الجديدة وجعل الحقول الشخصية اختيارية
- `forms/serializers.py`: إضافة validation مخصص
- `forms/citizen_feedback_view.py`: view مخصص جديد
- `forms/urls.py`: إضافة endpoint جديد
- `frontend/src/pages/forms/citizen-feedback.tsx`: تحديث معالجة الإرسال
- `frontend/src/utils/debugCitizenFeedback.ts`: تحديث الـ validation
- `backend/settings.py`: إصلاح إعدادات قاعدة البيانات

الحل الآن شامل ويجب أن يعمل بشكل صحيح للإرسال العادي والمجهول.
