// Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ†
export interface CitizenFeedbackFormData {
  feedback_type: string;
  full_name: string;
  national_id: string;
  phone_number: string;
  email: string;
  governorate: string;
  city: string;
  address: string;
  age: number;
  gender: string;
  education_level: string;
  occupation: string;
  related_entity: string;
  subject: string;
  description: string;
  priority: string;
  preferred_contact_method: string;
  previous_attempts: boolean;
  previous_attempts_description?: string;
  supporting_documents?: FileList;
  is_anonymous: boolean;
  consent_data_processing: boolean;
  consent_contact: boolean;
}

// Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
export function validateCitizenFeedbackData(data: CitizenFeedbackFormData): string[] {
  const errors: string[] = [];
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
  if (!data.feedback_type?.trim()) errors.push('Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ø·Ù„ÙˆØ¨');
  if (!data.subject?.trim()) errors.push('Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ø·Ù„ÙˆØ¨');
  if (!data.description?.trim()) errors.push('ÙˆØµÙ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ø·Ù„ÙˆØ¨');
  
  // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù…Ø¬Ù‡ÙˆÙ„Ø§Ù‹ØŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
  if (!data.is_anonymous) {
    if (!data.full_name?.trim()) errors.push('Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø·Ù„ÙˆØ¨');
    if (!data.phone_number?.trim()) errors.push('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ø·Ù„ÙˆØ¨');
    if (!data.email?.trim()) errors.push('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø·Ù„ÙˆØ¨');
    if (!data.address?.trim()) errors.push('Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ø·Ù„ÙˆØ¨');
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (data.email && !emailRegex.test(data.email)) {
      errors.push('ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­');
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
    const phoneRegex = /^[0-9+\-\s()]+$/;
    if (data.phone_number && !phoneRegex.test(data.phone_number)) {
      errors.push('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­');
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©
    if (data.national_id && data.national_id.length < 10) {
      errors.push('Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 10 Ø£Ø±Ù‚Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¹Ù…Ø±
    if (!data.age || data.age < 18 || data.age > 100) {
      errors.push('Ø§Ù„Ø¹Ù…Ø± ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 18 Ùˆ 100 Ø³Ù†Ø©');
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù†Ø³
    if (!data.gender?.trim()) errors.push('Ø§Ù„Ø¬Ù†Ø³ Ù…Ø·Ù„ÙˆØ¨');
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ
    if (!data.education_level?.trim()) errors.push('Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ù…Ø·Ù„ÙˆØ¨');
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù‡Ù†Ø©
    if (!data.occupation?.trim()) errors.push('Ø§Ù„Ù…Ù‡Ù†Ø© Ù…Ø·Ù„ÙˆØ¨Ø©');
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø©
    if (!data.governorate?.trim()) errors.push('Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ù…Ø·Ù„ÙˆØ¨Ø©');
    if (!data.city?.trim()) errors.push('Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù…Ø·Ù„ÙˆØ¨Ø©');
  } else {
    // ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„ØŒ ÙÙ‚Ø· Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù…Ø·Ù„ÙˆØ¨Ø©
    if (!data.governorate?.trim()) errors.push('Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ù…Ø·Ù„ÙˆØ¨Ø©');
    if (!data.city?.trim()) errors.push('Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù…Ø·Ù„ÙˆØ¨Ø©');
  }
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
  if (data.previous_attempts && !data.previous_attempts_description?.trim()) {
    errors.push('ÙˆØµÙ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù…Ø·Ù„ÙˆØ¨');
  }
  
  return errors;
}

// Ø¯Ø§Ù„Ø© Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ´Ø®ÙŠØµ
export function debugCitizenFeedbackData(data: CitizenFeedbackFormData): void {
  console.log('ğŸ” ØªØ´Ø®ÙŠØµ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ†:');
  console.log('ğŸ“‹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©:', data);
  
  const errors = validateCitizenFeedbackData(data);
  if (errors.length > 0) {
    console.error('âŒ Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', errors);
  } else {
    console.log('âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©');
  }
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„ØªÙˆÙƒÙ†
  const token = localStorage.getItem('access_token');
  if (!token) {
    console.error('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙˆÙƒÙ† Ù…ØµØ§Ø¯Ù‚Ø©');
  } else {
    console.log('âœ… ØªÙˆÙƒÙ† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù…ÙˆØ¬ÙˆØ¯');
  }
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„
  if (data.is_anonymous) {
    console.log('ğŸ­ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„ Ù…ÙØ¹Ù„');
  } else {
    console.log('ğŸ‘¤ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ');
  }
}

// Ø¯Ø§Ù„Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¥Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ Django
export function convertFieldNamesForDjango(data: CitizenFeedbackFormData): Record<string, any> {
  const fieldMapping = {
    'full_name': 'citizen_name',
    'phone_number': 'citizen_phone',
    'email': 'citizen_email',
    'address': 'citizen_address',
    'national_id': 'citizen_id',
    'subject': 'title',
  };
  
  const convertedData: Record<string, any> = {};
  
  Object.keys(data).forEach(key => {
    if (key !== 'supporting_documents') {
      const value = data[key as keyof CitizenFeedbackFormData];
      if (value !== null && value !== '' && value !== undefined) {
        const djangoFieldName = fieldMapping[key as keyof typeof fieldMapping] || key;
        convertedData[djangoFieldName] = value;
      }
    }
  });
  
  return convertedData;
}

// Create named export object
const debugCitizenFeedbackUtils = {
  validateCitizenFeedbackData,
  debugCitizenFeedbackData,
  convertFieldNamesForDjango
};

export default debugCitizenFeedbackUtils;
